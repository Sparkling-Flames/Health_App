{"version":3,"file":"group.js","sources":["pages/group/group.vue","../../../hbuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZ3JvdXAvZ3JvdXAudnVl"],"sourcesContent":["<template>\r\n  <view class=\"p-3\">\r\n    <view class=\"card\" v-if=\"!groupId\">\r\n      <input v-model=\"form.nickname\" placeholder=\"昵称\" />\r\n      <textarea v-model=\"form.info\" placeholder=\"简介/目标\" />\r\n      <button class=\"mt-2\" @click=\"create\">创建小组</button>\r\n    </view>\r\n    <view class=\"card\" v-else>\r\n      <view>当前小组：{{ groupId }}</view>\r\n      <button class=\"mt-2\" @click=\"loadMembers\">刷新成员</button>\r\n      <view class=\"mt-2\" v-for=\"u in members\" :key=\"u._id\">\r\n        {{ u.nickname }} {{ u.isLeader ? '(组长)' : '' }}\r\n      </view>\r\n    </view>\r\n    <view class=\"card mt-2\">\r\n      <view>加入已有小组</view>\r\n      <input v-model=\"joinId\" placeholder=\"输入小组ID\" />\r\n      <input v-model=\"joinNickname\" placeholder=\"你的昵称\" />\r\n      <button class=\"mt-2\" @click=\"join\">加入</button>\r\n    </view>\r\n    <view class=\"card mt-2\">\r\n      <button @click=\"list\">获取可加入小组列表</button>\r\n      <view\r\n        class=\"mt-2\"\r\n        v-for=\"g in groups\"\r\n        :key=\"g.groupId\"\r\n        @click=\"quickJoin(g.groupId)\"\r\n      >\r\n        #{{ g.groupId }} {{ g.leader }} ({{ g.member || 1 }}人)\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n<script setup>\r\nimport { reactive, ref } from 'vue'\r\nimport { onShow } from '@dcloudio/uni-app'\r\nimport { groupService } from '../../services/api.js'\r\n\r\nconst groupId = ref('')\r\nconst members = ref([])\r\nconst groups = ref([])\r\nconst form = reactive({ nickname: '', info: '' })\r\nconst joinId = ref('')\r\nconst joinNickname = ref('')\r\n\r\nconst loadMembers = async () => {\r\n  if (!groupId.value) return\r\n  try {\r\n    const res = await groupService.groupMembers(groupId.value)\r\n    members.value = res.userList || []\r\n  } catch (e) {\r\n    console.error(e)\r\n  }\r\n}\r\n\r\nconst loadMyGroup = async () => {\r\n  try {\r\n    const res = await groupService.getMyGroup()\r\n    groupId.value = res.groupId || ''\r\n    if (groupId.value) {\r\n      await loadMembers()\r\n    }\r\n  } catch (e) {\r\n    console.error(e)\r\n  }\r\n}\r\n\r\nconst create = async () => {\r\n  if (!form.nickname || !form.info) {\r\n    uni.showToast({ title: '请填写完整', icon: 'none' })\r\n    return\r\n  }\r\n  try {\r\n    const res = await groupService.createGroup({\r\n      nickname: form.nickname,\r\n      info: form.info\r\n    })\r\n    groupId.value = res.groupId\r\n    await loadMembers()\r\n  } catch (e) {\r\n    console.error(e)\r\n  }\r\n}\r\n\r\nconst join = async () => {\r\n  if (!joinId.value || !joinNickname.value) {\r\n    uni.showToast({ title: '缺少信息', icon: 'none' })\r\n    return\r\n  }\r\n  try {\r\n    const res = await groupService.joinGroup({\r\n      groupId: Number(joinId.value),\r\n      nickname: joinNickname.value,\r\n      info: '',\r\n      gender: '',\r\n      code: '',\r\n      age: 0,\r\n      region: []\r\n    })\r\n    groupId.value = res.groupId\r\n    await loadMembers()\r\n  } catch (e) {\r\n    console.error(e)\r\n  }\r\n}\r\n\r\nconst list = async () => {\r\n  try {\r\n    const res = await groupService.listGroups()\r\n    groups.value = res.groupList || []\r\n  } catch (e) {\r\n    console.error(e)\r\n  }\r\n}\r\n\r\nconst quickJoin = (id) => {\r\n  joinId.value = String(id)\r\n}\r\n\r\nonShow(loadMyGroup)\r\n</script>\r\n<style scoped>\r\ninput,textarea{border:1px solid #eee;padding:12rpx;border-radius:8rpx;margin-top:12rpx;width:100%}\r\nbutton{background:#1afa29;color:#fff;padding:16rpx;border-radius:8rpx;}\r\n</style>\r\n","import MiniProgramPage from 'D:/Work/unicode/health_app/pages/group/group.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","groupService","uni","onShow"],"mappings":";;;;;;AAsCA,UAAM,UAAUA,cAAG,IAAC,EAAE;AACtB,UAAM,UAAUA,cAAG,IAAC,EAAE;AACtB,UAAM,SAASA,cAAG,IAAC,EAAE;AACrB,UAAM,OAAOC,cAAQ,SAAC,EAAE,UAAU,IAAI,MAAM,IAAI;AAChD,UAAM,SAASD,cAAG,IAAC,EAAE;AACrB,UAAM,eAAeA,cAAG,IAAC,EAAE;AAE3B,UAAM,cAAc,YAAY;AAC9B,UAAI,CAAC,QAAQ;AAAO;AACpB,UAAI;AACF,cAAM,MAAM,MAAME,aAAAA,aAAa,aAAa,QAAQ,KAAK;AACzD,gBAAQ,QAAQ,IAAI,YAAY,CAAE;AAAA,MACnC,SAAQ,GAAG;AACVC,sBAAAA,MAAc,MAAA,SAAA,+BAAA,CAAC;AAAA,MAChB;AAAA,IACH;AAEA,UAAM,cAAc,YAAY;AAC9B,UAAI;AACF,cAAM,MAAM,MAAMD,aAAY,aAAC,WAAY;AAC3C,gBAAQ,QAAQ,IAAI,WAAW;AAC/B,YAAI,QAAQ,OAAO;AACjB,gBAAM,YAAa;AAAA,QACpB;AAAA,MACF,SAAQ,GAAG;AACVC,sBAAAA,MAAc,MAAA,SAAA,+BAAA,CAAC;AAAA,MAChB;AAAA,IACH;AAEA,UAAM,SAAS,YAAY;AACzB,UAAI,CAAC,KAAK,YAAY,CAAC,KAAK,MAAM;AAChCA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAC9C;AAAA,MACD;AACD,UAAI;AACF,cAAM,MAAM,MAAMD,aAAY,aAAC,YAAY;AAAA,UACzC,UAAU,KAAK;AAAA,UACf,MAAM,KAAK;AAAA,QACjB,CAAK;AACD,gBAAQ,QAAQ,IAAI;AACpB,cAAM,YAAa;AAAA,MACpB,SAAQ,GAAG;AACVC,sBAAAA,MAAc,MAAA,SAAA,+BAAA,CAAC;AAAA,MAChB;AAAA,IACH;AAEA,UAAM,OAAO,YAAY;AACvB,UAAI,CAAC,OAAO,SAAS,CAAC,aAAa,OAAO;AACxCA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAC7C;AAAA,MACD;AACD,UAAI;AACF,cAAM,MAAM,MAAMD,aAAY,aAAC,UAAU;AAAA,UACvC,SAAS,OAAO,OAAO,KAAK;AAAA,UAC5B,UAAU,aAAa;AAAA,UACvB,MAAM;AAAA,UACN,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,KAAK;AAAA,UACL,QAAQ,CAAE;AAAA,QAChB,CAAK;AACD,gBAAQ,QAAQ,IAAI;AACpB,cAAM,YAAa;AAAA,MACpB,SAAQ,GAAG;AACVC,sBAAAA,MAAc,MAAA,SAAA,gCAAA,CAAC;AAAA,MAChB;AAAA,IACH;AAEA,UAAM,OAAO,YAAY;AACvB,UAAI;AACF,cAAM,MAAM,MAAMD,aAAY,aAAC,WAAY;AAC3C,eAAO,QAAQ,IAAI,aAAa,CAAE;AAAA,MACnC,SAAQ,GAAG;AACVC,sBAAAA,MAAc,MAAA,SAAA,gCAAA,CAAC;AAAA,MAChB;AAAA,IACH;AAEA,UAAM,YAAY,CAAC,OAAO;AACxB,aAAO,QAAQ,OAAO,EAAE;AAAA,IAC1B;AAEAC,kBAAM,OAAC,WAAW;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtHlB,GAAG,WAAW,eAAe;"}