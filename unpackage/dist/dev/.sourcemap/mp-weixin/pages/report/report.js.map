{"version":3,"file":"report.js","sources":["pages/report/report.vue","../../../hbuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcmVwb3J0L3JlcG9ydC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"p-3\">\r\n    <view class=\"card\">\r\n      <view>报告生成</view>\r\n      <picker mode=\"date\" @change=\"onStart\" :value=\"start\">\r\n        <view class=\"mt-2\">开始日期：{{ start }}</view>\r\n      </picker>\r\n      <picker mode=\"date\" @change=\"onEnd\" :value=\"end\">\r\n        <view class=\"mt-2\">结束日期：{{ end }}</view>\r\n      </picker>\r\n      <button class=\"mt-2\" @click=\"generate\">生成基础报告</button>\r\n    </view>\r\n    <view v-if=\"report\" class=\"card mt-2\">\r\n      <view>基础统计：</view>\r\n      <view>总摄入：{{ report.totalDiet }} kcal</view>\r\n      <view>总消耗：{{ report.totalSport }} kcal</view>\r\n      <button class=\"mt-2\" @click=\"ai\">AI 总结</button>\r\n    </view>\r\n    <view v-if=\"aiText\" class=\"card mt-2\">\r\n      <view>AI 分析：</view>\r\n      <text>{{ aiText }}</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { reportService, dietService, sportService } from '../../services/api.js'\r\n\r\nconst start = ref('')\r\nconst end = ref('')\r\nconst report = ref(null)\r\nconst aiText = ref('')\r\n\r\nconst onStart = (e) => {\r\n  start.value = e.detail.value\r\n}\r\n\r\nconst onEnd = (e) => {\r\n  end.value = e.detail.value\r\n}\r\n\r\nconst generate = async () => {\r\n  if (!start.value || !end.value) {\r\n    uni.showToast({ title: '选择日期', icon: 'none' })\r\n    return\r\n  }\r\n  const days = []\r\n  const endDate = new Date(end.value)\r\n  const cursor = new Date(start.value)\r\n  while (cursor <= endDate) {\r\n    days.push(cursor.toISOString().slice(0, 10))\r\n    cursor.setDate(cursor.getDate() + 1)\r\n  }\r\n  let dietTotal = 0\r\n  let sportTotal = 0\r\n  for (const d of days) {\r\n    try {\r\n      const diet = await dietService.dailyDiet(d)\r\n      dietTotal += (diet.records || []).reduce((s, i) => s + i.calories, 0)\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n    try {\r\n      const sport = await sportService.dailySport(d)\r\n      sportTotal += (sport.records || []).reduce((s, i) => s + i.calories, 0)\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n  }\r\n  report.value = { totalDiet: dietTotal, totalSport: sportTotal }\r\n  aiText.value = ''\r\n}\r\n\r\nconst ai = async () => {\r\n  if (!report.value) return\r\n  try {\r\n    const generated = await reportService.generate({\r\n      start: start.value,\r\n      end: end.value\r\n    })\r\n    const aiRes = await reportService.aiSummary(generated.reportId)\r\n    aiText.value = aiRes.text || '暂无AI返回'\r\n  } catch (e) {\r\n    console.error(e)\r\n  }\r\n}\r\n</script>\r\n<style scoped>\r\nbutton{background:#1afa29;color:#fff;padding:16rpx;border-radius:8rpx;}\r\n</style>\r\n","import MiniProgramPage from 'D:/Work/unicode/health_app/pages/report/report.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","dietService","sportService","reportService"],"mappings":";;;;;;AA4BA,UAAM,QAAQA,cAAG,IAAC,EAAE;AACpB,UAAM,MAAMA,cAAG,IAAC,EAAE;AAClB,UAAM,SAASA,cAAG,IAAC,IAAI;AACvB,UAAM,SAASA,cAAG,IAAC,EAAE;AAErB,UAAM,UAAU,CAAC,MAAM;AACrB,YAAM,QAAQ,EAAE,OAAO;AAAA,IACzB;AAEA,UAAM,QAAQ,CAAC,MAAM;AACnB,UAAI,QAAQ,EAAE,OAAO;AAAA,IACvB;AAEA,UAAM,WAAW,YAAY;AAC3B,UAAI,CAAC,MAAM,SAAS,CAAC,IAAI,OAAO;AAC9BC,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAC7C;AAAA,MACD;AACD,YAAM,OAAO,CAAE;AACf,YAAM,UAAU,IAAI,KAAK,IAAI,KAAK;AAClC,YAAM,SAAS,IAAI,KAAK,MAAM,KAAK;AACnC,aAAO,UAAU,SAAS;AACxB,aAAK,KAAK,OAAO,YAAa,EAAC,MAAM,GAAG,EAAE,CAAC;AAC3C,eAAO,QAAQ,OAAO,QAAO,IAAK,CAAC;AAAA,MACpC;AACD,UAAI,YAAY;AAChB,UAAI,aAAa;AACjB,iBAAW,KAAK,MAAM;AACpB,YAAI;AACF,gBAAM,OAAO,MAAMC,yBAAY,UAAU,CAAC;AAC1C,wBAAc,KAAK,WAAW,CAAE,GAAE,OAAO,CAAC,GAAG,MAAM,IAAI,EAAE,UAAU,CAAC;AAAA,QACrE,SAAQ,GAAG;AACVD,wBAAAA,MAAc,MAAA,SAAA,iCAAA,CAAC;AAAA,QAChB;AACD,YAAI;AACF,gBAAM,QAAQ,MAAME,0BAAa,WAAW,CAAC;AAC7C,yBAAe,MAAM,WAAW,CAAE,GAAE,OAAO,CAAC,GAAG,MAAM,IAAI,EAAE,UAAU,CAAC;AAAA,QACvE,SAAQ,GAAG;AACVF,wBAAAA,MAAc,MAAA,SAAA,iCAAA,CAAC;AAAA,QAChB;AAAA,MACF;AACD,aAAO,QAAQ,EAAE,WAAW,WAAW,YAAY,WAAY;AAC/D,aAAO,QAAQ;AAAA,IACjB;AAEA,UAAM,KAAK,YAAY;AACrB,UAAI,CAAC,OAAO;AAAO;AACnB,UAAI;AACF,cAAM,YAAY,MAAMG,aAAa,cAAC,SAAS;AAAA,UAC7C,OAAO,MAAM;AAAA,UACb,KAAK,IAAI;AAAA,QACf,CAAK;AACD,cAAM,QAAQ,MAAMA,aAAAA,cAAc,UAAU,UAAU,QAAQ;AAC9D,eAAO,QAAQ,MAAM,QAAQ;AAAA,MAC9B,SAAQ,GAAG;AACVH,sBAAAA,MAAc,MAAA,SAAA,iCAAA,CAAC;AAAA,MAChB;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;ACpFA,GAAG,WAAW,eAAe;"}